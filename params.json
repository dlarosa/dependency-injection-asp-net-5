{"name":"Dependency Injection in ASP.NET 5","tagline":"How to implement dependency injection in your ASP.NET 5 project","body":"Dependency injection is at the heart of ASP.NET 5. Much has been written about it since last year, but in this demo I would like to provide a simple example of how to use dependency injection to inject a service in an ASP.NET 5 Controller.\r\n\r\nTo achieve this, we will create an ASP.NET 5 application that displays the weather forecast. This application will be able to use two different services: WeatherService, which uses [WeatherNet](https://www.nuget.org/packages/WeatherNet/ \"WeatherNet\") to provide real weather forecast, and WeatherService2, which as you will see later, it is not a very reliable forecast provider.\r\n\r\nLater in the demo, I will demonstrate how easy it is to modify our application and switch between these two services. Let’s get to it.\r\n\r\n###Creating the service\r\n\r\nThe first thing we need to do is to create an interface that our services can implement. This interface will only have one method, which will provide the weather forecast based on a location.\r\n \r\n \r\n```csharp\r\n\r\npublic interface IWeatherService\r\n{\r\n    string GetWeather(string city, string country);\r\n}\r\n```\r\n\r\nOnce we have the interface, we create a new class that will contain the service implementation. This service we will retrieve and return the weather forecast using WeatherNet, based on the city and country.\r\n\r\n```csharp\r\npublic class WeatherService :IWeatherService\r\n{\r\n\r\n    public string GetWeather(string city, string country)\r\n    {\r\n        var wClient = new WeatherNet.Clients.CurrentWeather();\r\n        var weather = wClient.GetByCityName(city, country).Item.Description;\r\n        \r\n        return string.Format(\"WeatherService \\n\\n{0} in {1} ({2})\", weather, city, country);\r\n    }\r\n}\r\n```\r\n\r\nNow, we add the WeatherService2 implementation in a new class. This service will not retrieve the weather using any third party. Instead, it will make the assumption that there is heavy snow everywhere. A little bit scary, right? ;)\r\n\r\n```csharp\r\npublic class WeatherService2 : IWeatherService\r\n{\r\n\r\n    public string GetWeather(string city, string country)\r\n    {\r\n        var weather = \"Heavy Snow\";\r\n        \r\n        return string.Format(\"WeatherService2 \\n\\n{0} in {1} ({2})\", weather, city, country);\r\n    }\r\n}\r\n```\r\n\r\nIn our sample application, I put the three classes in three different files under a Service folder created in the root folder.\r\n\r\n<p align=\"center\">\r\n  <img src=\"https://raw.githubusercontent.com/dlarosa/dependency-injection-asp-net-5/master/images/1.PNG?raw=true\" alt=\"\"/>\r\n </p>\r\n\r\n###Injecting the service into the controller\r\n \r\nIt's time to inject the service to our Controller. To do this, we create a Controller constructor, which is going to take an IWeatherService implementation as a parameter. We also create a private field so that it's available to the rest of the methods of the Controller.\r\n \r\n ```csharp\r\nIWeatherService _weatherService;\r\npublic HomeController(IWeatherService weatherService)\r\n{\r\n     _weatherService = weatherService;\r\n}\r\n ```\r\n\r\n\r\nNow we want to use the injected service in the Index method of our Controller to return the weather forecast. To keep it simple, the parameters will be hard coded in this method.\r\n\r\n\r\n```csharp\r\n[HttpGet(\"/\")]\r\npublic string Index()\r\n{\r\n    return _weatherService.GetWeather(\"Miami\", \"US\");\r\n}\r\n```\r\n\r\n \r\n\r\n###Registering the service\r\n \r\nNow let's do some magic and use the new dependency injection feature that comes with ASP.NET 5.\r\n\r\nIn the Startup.cs file we have a ConfigureService method, which we need to add the following line to register our service in the application:\r\n\r\n```csharp\r\npublic void ConfigureServices(IServiceCollection services)\r\n{\r\n    services.AddMvc();\r\n    services.AddInstance<IWeatherService>(new WeatherService());\r\n}\r\n```\r\n            \r\nThis line means that every time our app needs an instance of IWeatherService, the WeatherService implementation will be used. \r\n\r\nNotice that we have used the AddInstance method to register our service, this is going to provide the same service instance for each HTTP request that uses the service. \r\n\r\nHowever in some cases we may want to create a new instance every time that the service is used. In this case, we can use something like the AddTransient method, which will provide a new instance of the service every time it's needed:\r\n\r\n```csharp\r\nservices.AddTransient<IWeatherService>(x=> new WeatherService());\r\n```\r\n\r\n\r\n\r\n###Running the application!\r\n\r\nWe now run our application and observe how, as expected, the sky is clear in Miami. This seems right to me, and means that our WeatherService implementation was used.\r\n\r\n\r\n\r\n<p align=\"center\">\r\n  <img src=\"https://raw.githubusercontent.com/dlarosa/dependency-injection-asp-net-5/master/images/2.PNG?raw=true\" alt=\"\"/>\r\n </p>\r\n\r\n\r\nIf, for any reason, we want to use WeatherService2, we just need to modify the ConfigureServices method.\r\n\r\n```csharp\r\npublic void ConfigureServices(IServiceCollection services)\r\n{\r\n      services.AddMvc();\r\n      services.AddInstance<IWeatherService>(new WeatherService2());\r\n}\r\n```\r\n\r\nLet's run our application again, and voilà. Heavy snow in Miami, which means that this time our application used the WeatherService2 implementation.\r\n\r\n <p align=\"center\">\r\n  <img src=\"https://raw.githubusercontent.com/dlarosa/dependency-injection-asp-net-5/master/images/3.PNG?raw=true\" alt=\"\"/>\r\n </p>\r\n\r\n\r\n\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}